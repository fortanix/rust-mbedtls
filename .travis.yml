branches:
  only:
    # This is where pull requests from "bors r+" are built.
    - staging
    # This is where pull requests from "bors try" are built.
    - trying
    # Not really necessary, just to get a green badge on “master”
    - master
language: rust
os: linux
dist: xenial

jobs:
  include:
    - name: "Rust stable"
      rust: stable
    - name: "Rust beta"
      rust: beta
    - name: "Rust nightly"
      rust: beta
    - name: "Rust nightly (core_io)"
      rust: nightly-2019-07-01
    - name: "Rust nightly (SGX)"
      rust: nightly-2019-10-28
    - name: "Rust stable (Aarch64)"
      arch: arm64
      rust: stable

  allow_failures:
    - name: "Rust stable (Aarch64)"
      arch: arm64
      rust: stable

addons:
  apt:
    packages:
    - llvm-3.8-dev
    - libclang-3.8-dev
    - clang-3.8
    - cmake

env:
  global:
    - RUST_BACKTRACE=1
    # Pinned to this particular nightly version because of core_io. This can be
    # re-pinned whenever core_io is updated to the latest nightly.
    - CORE_IO_NIGHTLY=nightly-2019-07-01
    - SGX_NIGHTLY=nightly-2019-10-28
    - LLVM_CONFIG_PATH=llvm-config-3.8
script:
  - ./ct.sh
